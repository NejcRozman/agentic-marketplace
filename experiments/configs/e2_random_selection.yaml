# E2 Random Selection - Heterogeneous Market Exposure
# Research Question: RQ2, RQ3 - Quality-Cost Trade-off & Reputation with Unequal Market Access
# Description: 5 sequential auctions where consumer randomly selects 3 providers from pool of 5 per auction

experiment:
  id: "e2_random_selection"
  name: "Random Selection - Heterogeneous Market Exposure"
  description: |
    Tests system behavior when consumers randomly select subset of providers for each auction.
    Models realistic scenarios where buyers have limited attention and create heterogeneous market exposure.
    Design: 5 providers in pool, consumer randomly selects 3 per auction.
  research_question: "RQ2, RQ3"
  duration_timeout: 21600  # Maximum 6 hours for entire experiment
  
blockchain:
  network: "anvil"
  rpc_url: "http://localhost:8545"
  fork_network: "sepolia"  # Fork from Sepolia to get ERC-8004 contracts
  infura_key_env: "INFURA_API_KEY"  # Read from environment
  
  contracts:
    # Addresses of contracts (deployed by experiment or pre-existing)
    reverse_auction: null  # null = deploy new
    identity_registry: "0x8004a6090Cd10A7288092483047B097295Fb8847"  # Sepolia ERC-8004
    reputation_registry: "0x8004B8FD1A363aa02fDC07635C0c5F94f6Af5B7E"  # Sepolia ERC-8004
    payment_token: null  # null = deploy mock USDC
    
  accounts:
    main_account: "${BLOCKCHAIN_PRIVATE_KEY}"
    deployer: "${BLOCKCHAIN_PRIVATE_KEY}"
    consumer: "${BLOCKCHAIN_CONSUMER_PRIVATE_KEY}"
    providers:
      - "${BLOCKCHAIN_PRIVATE_KEY}"  # Only need 1 key, experiment runner generates others
    
    # Funding configuration for consumer account
    consumer_funding:
      eth_amount: 2000000000000000000  # 2 ETH in wei
      usdc_amount: 2000000000  # 2000 USDC (6 decimals)

agents:
  consumer:
    count: 1
    agent_id: null  # null = register new agent
    private_key: null  # null = use blockchain.accounts.consumer
    
    config:
      check_interval: 5  # Check blockchain every 5 seconds
      max_budget: 100000000  # 100 USDC per auction (with 6 decimals)
      auction_duration: 60  # 1 minute per auction
      
    behavior:
      pdf_directory: "utils/files"  # Use existing test PDFs
      service_selection: "sequential"  # Use PDFs in order
      service_complexity: "medium"
      auto_create_auction: true  # Create auction immediately on start
      num_auctions: 50 # Create 50 sequential auctions
      auto_monitor: true  # Monitor auction automatically
      inter_auction_delay: 5  # Wait 5 seconds between auctions
      eligible_per_auction: 5  # Randomly select 5 providers per auction
      
  providers:
    count: 10  # Create 10 provider agents
    agent_ids: [null, null, null, null, null, null, null, null, null, null]  # null = register new agents
    private_keys: null  # null = use blockchain.accounts.providers
    
    config:
      check_interval: 5  # Check blockchain every 5 seconds
      
    behavior:
      strategy: "honest"  # All providers use normal quality and competitive bidding
      auto_bid: true  # Automatically bid on detected auctions
      auto_execute: true  # Automatically execute won services
      auto_complete: true  # Automatically complete on blockchain
     
experiment_flow:
  phases:
    - name: "setup"
      description: "Start Anvil, deploy contracts, register agents, mint USDC"
      timeout: 120  # 2 minutes to set up blockchain
      
    - name: "agents_start"
      description: "Launch consumer and provider agents"
      timeout: 30  # 30 seconds for agents to initialize
      
    - name: "experiment_run"
      description: "Agents operate autonomously until target auctions completed"
      stopping_criteria:
        type: "completed_auctions"  # Poll consumer.get_status()['completed_auctions']
        poll_interval: 5  # Check every 5 seconds
        max_timeout: 7200  # 2 hours absolute maximum
  
  # Reputation tracking configuration
  reputation_snapshots:
    enabled: true  # Take reputation snapshots after each auction
    after_feedback: true  # Snapshot after feedback is submitted
    include_all_providers: true  # Include all providers, not just winners
  
monitoring:
  metrics:
    - auction_created  # Did consumer create auction successfully?
    - bids_received  # How many providers bid?
    - eligible_providers  # Which providers were eligible per auction?
    - auction_winner  # Which provider won?
    - service_executed  # Did winner execute service?
    - service_completed  # Was service marked complete on-chain?
    - reputation_updated  # Was reputation updated?
    - final_reputations  # All agent reputations at end
    - gas_costs  # Total gas used
    - timing  # Duration of each phase
    - reputation_evolution  # Track reputation changes across auctions
    - win_distribution  # How many times each provider won
    - opportunity_distribution  # How many times each provider was eligible
    - bid_trends  # How bid amounts change over time
    - quality_trends  # How service quality changes over time
    
  logs:
    directory: "experiments/data/logs/e2_random_selection"
    format: "json"
    level: "INFO"
    
  output:
    directory: "experiments/data/metrics/e2_random_selection"
    format: "json"

api_keys:
  # These are read from environment variables
  google_api_key_env: "GOOGLE_API_KEY"
  pinata_api_key_env: "PINATA_API_KEY"
  pinata_secret_env: "PINATA_SECRET_KEY"
