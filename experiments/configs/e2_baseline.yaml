# E2 Baseline - Multiple Auctions with Reputation Evolution
# Research Question: RQ2, RQ3 - Quality-Cost Trade-off & Reputation Effectiveness
# Description: 5 sequential auctions to establish baseline market behavior and reputation dynamics

experiment:
  id: "e2_baseline"
  name: "Baseline - Multiple Auctions"
  description: "Test reputation evolution and market dynamics with 1 consumer and 3 honest providers completing 5 auctions"
  research_question: "RQ2, RQ3"
  duration_timeout: 7200  # Maximum 2 hours for entire experiment (5 auctions × ~20 min each)
  
blockchain:
  network: "anvil"
  rpc_url: "http://localhost:8545"
  fork_network: "sepolia"  # Fork from Sepolia to get ERC-8004 contracts
  infura_key_env: "INFURA_API_KEY"  # Read from environment
  
  contracts:
    # Addresses of contracts (deployed by experiment or pre-existing)
    reverse_auction: null  # null = deploy new, or specify address
    identity_registry: "0x8004a6090Cd10A7288092483047B097295Fb8847"  # Sepolia ERC-8004
    reputation_registry: "0x8004B8FD1A363aa02fDC07635C0c5F94f6Af5B7E"  # Sepolia ERC-8004
    payment_token: null  # null = deploy mock USDC
    
  accounts:
    # Use your personal account (proven to work with ERC-8004)
    # Private keys loaded from environment variable for security
    main_account: "${BLOCKCHAIN_PRIVATE_KEY}"
    
    # Separate account for consumer to enable feedback (different address from providers)
    # This account will be funded with ETH and USDC by the experiment runner
    deployer: "${BLOCKCHAIN_PRIVATE_KEY}"
    consumer: "${BLOCKCHAIN_CONSUMER_PRIVATE_KEY}"  # Set this to a different private key
    providers:
      - "${BLOCKCHAIN_PRIVATE_KEY}"
      - "${BLOCKCHAIN_PRIVATE_KEY}"
      - "${BLOCKCHAIN_PRIVATE_KEY}"
    
    # Funding configuration for consumer account
    consumer_funding:
      eth_amount: 2000000000000000000  # 2 ETH in wei (more for 5 auctions)
      usdc_amount: 2000000000  # 2000 USDC (6 decimals) - enough for 5×100 USDC + gas

agents:
  consumer:
    count: 1
    agent_id: null  # null = register new agent (required for fresh Anvil)
    private_key: null  # null = use blockchain.accounts.consumer
    eligible_providers: null  # null = experiment runner will set this after registering providers
    
    config:
      check_interval: 5  # Check blockchain every 5 seconds
      max_budget: 100000000  # 100 USDC per auction (with 6 decimals)
      auction_duration: 300  # 5 minutes per auction
      reputation_weight: 30  # 0-100: weight of reputation vs price (30 = 30% reputation, 70% price)
      
    behavior:
      pdf_directory: "utils/files"  # Use existing test PDFs
      service_selection: "sequential"  # Use PDFs in order: 1.pdf, 2.pdf, 3.pdf, 1.pdf, 2.pdf
      service_complexity: "medium"
      auto_create_auction: true  # Create auction immediately on start
      num_auctions: 5  # Create 5 sequential auctions
      auto_monitor: true  # Monitor auction automatically
      inter_auction_delay: 30  # Wait 30 seconds between auctions
      
  providers:
    count: 3
    agent_ids: [null, null, null]  # null = register new agents for each
    private_keys: null  # null = use blockchain.accounts.providers
    
    config:
      check_interval: 5  # Check blockchain every 5 seconds
      
    behavior:
      strategy: "honest"  # All providers use normal quality and competitive bidding
      auto_bid: true  # Automatically bid on detected auctions
      auto_execute: true  # Automatically execute won services
      auto_complete: true  # Automatically complete on blockchain
     
experiment_flow:
  phases:
    - name: "setup"
      description: "Start Anvil, deploy contracts, register agents, mint USDC"
      timeout: 120  # 2 minutes to set up blockchain
      
    - name: "agents_start"
      description: "Launch consumer and provider agents"
      timeout: 30  # 30 seconds for agents to initialize
      
    - name: "experiment_run"
      description: "Agents operate autonomously until target auctions completed"
      stopping_criteria:
        type: "completed_auctions"  # Poll consumer.get_status()['completed_auctions']
        target: 5  # Stop when 5 auctions are completed
        poll_interval: 5  # Check every 5 seconds
        max_timeout: 7200  # 2 hours absolute maximum
      
  target_auctions: 5  # Number of auctions to complete before stopping
  
  # Reputation tracking configuration
  reputation_snapshots:
    enabled: true  # Take reputation snapshots after each auction
    after_feedback: true  # Snapshot after feedback is submitted
    include_all_providers: true  # Include all providers, not just winners
  
monitoring:
  metrics:
    - auction_created  # Did consumer create auction successfully?
    - bids_received  # How many providers bid?
    - auction_winner  # Which provider won?
    - service_executed  # Did winner execute service?
    - service_completed  # Was service marked complete on-chain?
    - reputation_updated  # Was reputation updated?
    - final_reputations  # All agent reputations at end
    - gas_costs  # Total gas used
    - timing  # Duration of each phase
    - reputation_evolution  # Track reputation changes across auctions
    - win_distribution  # How many times each provider won
    - bid_trends  # How bid amounts change over time
    - quality_trends  # How service quality changes over time
    
  logs:
    directory: "experiments/data/logs/e2_baseline"
    format: "json"
    level: "INFO"
    
  output:
    directory: "experiments/data/metrics/e2_baseline"
    format: "json"

api_keys:
  # These are read from environment variables
  google_api_key_env: "GOOGLE_API_KEY"
  pinata_api_key_env: "PINATA_API_KEY"
  pinata_secret_env: "PINATA_SECRET_KEY"
